# Physicochemical and Sensory Analysis for Wine Quality  
### July 2017, by Jude Moon

========================================================

# 1.Overview
In this project, I will use a white wine quality data set for [Portuguese "Vinho Verde" wine](http://www.vinhoverde.pt/en/about-vinho-verde), whose data were collected and published by [Cortez et al (2009)](http://www.sciencedirect.com/science/article/pii/S0167923609001377?via%3Dihub). This tidy data set contains 4,898 white wines with 11 variables on quantifying the physicochemical properties of each wine. At least 3 wine experts rated the quality of each wine, providing a rating between 0 (very bad) and 10 (very excellent). Details and units of the variables are provided [here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt). The objectives of the analysis is to explore data to determine (1) whether any relationship between the physicochemical properties and sensory quality exists and (2) if so, which physicochemical properties are the most effective to describe qualty, in other words, which properties are highly correlated with the quality score. 
```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(ggthemes)
library(gridExtra)
library(dplyr)
library(alr3)
library(reshape2)
library(tidyr)
library(GGally)
library(scales)
library(memisc)
library(lattice)
library(MASS)
library(car)
library(devtools)
library(knitr)
library(plyr)
library(mvoutlier)
library(qgraph)
library(psych)
library(factoextra)
library(rgl)
```

```{r echo=FALSE, warning=TRUE}
# Load the Data
# Name the dataset 'White Wine quality', 'ww' for simplicity
ww <- read.csv('wineQualityWhites.csv') 
```

------
# 2. Analysis
## 2.1.2 Univariate Plots Section

### Data Summary: 
#### What are the data types of the columns?
```{r echo=FALSE}
# Display data type of each column
str(ww)
```
All columns are numeric or continuous, except X and quality. X is wine sample ID, so changing to factor data type would make more sense.

#### What are the data ranges of variables?
```{r echo=FALSE, Univariate_Plots_Summary}
# Change X from int to factor
ww$X <- factor(ww$X, ordered = F)  
summary(ww)
```
The data range of each variable varies, e.g., volatile.acidity ranges from 0.08 to 1.1 while total.sulfur.dioxide ranges from 9 to 440. This suggests that data transformation such as standardization might require to compare two variables. 

#### Is there any missing values (na) or any zero values?
```{r echo=FALSE, Univariate_Plots_Missing}
#summary(is.na(ww))
summary(ww == 0)
```
There is no missing value, but Variable citric.acid has 19 zeros. I will assume that they are true zeros.

### Quality score: response variable or label feature
#### Can I engineer this variable simpler to interpret?
I will create categorical variables of quality which is integer variable ranged from 3 to 9. One way is to convert into 7 classes (called **quality.order**) and the other is into 3 classes(called **quality.con** and **quality.lib**), where I can simply interpret as bad, ok, and good quality.
```{r echo=FALSE, Univariate_Plots_quality.order}
# Change from int to ordered factor
ww$quality.order <- factor(ww$quality, ordered = T)
str(ww$quality.order)
```

#### What is distribution of quality?
```{r echo=FALSE, fig.height=3, fig.width=3, message=FALSE, warning=FALSE}
# Create a bar plot, similar to histogram
plot(ww$quality.order, xlab = 'quality.order') 

# Create a function to generate a proportion table in percentage
ProportionTable <- function(col) {
  freq <- table(col)
  prop <- (freq/length(col))*100
  return(prop)
}

# Create a proportion table for quality.order
ProportionTable(ww$quality.order)
```
Quality is normally distributed. Quality score 6 is the most common quality for white wines (45%). Most white wines had a quality score between 5 and 6, which accounting for 75% of the total. If I predict that a product of white wine is in quality of 5 or 6, there will be 75% chance to be correct. White wines with a quality score between 5 and 7 and that between 4 and 8 were 92.6% and 99.5% respectively. 

#### What are the distributions of 3-classes variables?
```{r echo=FALSE, fig.height=3, fig.width=3, message=FALSE, warning=FALSE}
# Create new varaibles by cutting into 3 buckets
ww$quality.con <- cut(ww$quality, c(2, 5, 6, 9)) # conservative cutoff
ww$quality.lib <- cut(ww$quality, c(2, 4, 7, 9)) # liberal cutoff

# Craete distribution plots and proportion tables for the new variables
plot(ww$quality.con, xlab = 'quality.con')
ProportionTable(ww$quality.con)
plot(ww$quality.lib, xlab = 'quality.lib')
ProportionTable(ww$quality.lib)
```
I created 2 new variables; each includes 3-classes. One is that I named **quality.con** which cuts off the quality in a conservative way. This considers that wines with the score <6 are low quality, 6 are medium quality, and >6 are high quality. 

The other I named **quality.lib** separates quality in a liberal way, where wine with a wide ranged score from 5 to 7 are considered as ok quality, <5 are low quality, and >7 are high quality.

The distribution of quality.con is relatively even in the 3 classes, while that of quality.lib varies. The purpose of using quality.con would be to find general trends of low and high quality wine, while quality.lib would be better for screening exceptionally low or high quality wine.

### Variables related to features
I sorted some of variables into a related features to help organize variables as a meaningful order.
| Order |     Feature     |                        Variables                        |
|:-----:|:---------------:|:-------------------------------------------------------:|
|   1   |       body      |                         alcohol                         |
|   2   |      sweet      |                      residual.sugar                     |
|   3   |      salty      |                        chlorides                        |
|   4   |      dense      |                         density                         |
|   5   | sour or acidity |   pH, fixed.acidity, volatile.acidity, and citric.acid  |
|   6   |   preservative  | sulphates,total.sulfur.dioxide, and free.sulfur.dioxide |

### Alcohol content
#### How the alcohol variable is distributed? Any new variables are needed?
The weakest and the strongest white wines are 8.0% and 14.2% of alcohol, respectively. The distributions of < 9.5, 9.5-10.4, 10.5-11.4, and >11.4 are even, so I created a new variable called **alcohol.bucket**, which separated alcohol content into 4 classes. This might help with further analysis on its relationship with other variables.

Additionally, as a conventionaly rule, light-bodied wines are 7-11 % alcohol, medium run 11-13%, and full-bodied are over 13%. The body of the wine is how it feels in your mouth. When a wine is full-bodied, it completely coats the palate and tends to feel heavier in the mouth. Also, the texture of the wine either smooth/velvety or coarse/brash contributes to feeling in the mouth. In addition to alcohol.bucket, I created a new variable called **alcohol.body**, which separated alcohol content into 3 classes. This might help to understand relationship between the preference of wine body and wine quality.
```{r echo=FALSE, fig.height=3, fig.width=5, message=FALSE, warning=FALSE}
# Create new varaibles by cutting into buckets
ww$alcohol.bucket <- cut(ww$alcohol,
                             c(7.9, 9.4, 10.4, 11.4, 14.20)) # evenly cutting into 4 classes
ww$alcohol.body <- cut(ww$alcohol,
                             c(7, 11, 13, 15)) # conventional grouping into 3 classes

# Create a function to generate a histogram with color encoding of categorical variable,
# a table, and a proportion table
Plot1 <- function(col1, col2) {
  a <- qplot(x = col1, data = ww, binwidth = 0.1, color = I('black'), fill = col2)+
  scale_x_continuous(limits = c(min(col1), max(col1)),
                     breaks = seq(8, max(col1), 1))
  b <- table(col2)
  c <- ProportionTable(col2)
  return(list(a, b, c))
}

# Explore distribution of alcohol variable
Plot1(ww$alcohol, ww$alcohol.bucket)
Plot1(ww$alcohol, ww$alcohol.body)
```
The distribution is little bit skewed to the left with mostly (68%) being light-bodied (acohol <= 11). But I don't think that it requires transformation because the skewness seems minor. 

### Sugar content
#### How the residual.sugar variable is distriubted? Any new variables are needed?
```{r echo=FALSE, fig.height=3, fig.width=7, message=FALSE, warning=FALSE}
# Explore distribution of residual.sugar variable
sugar.dist <- qplot(x = residual.sugar, data = ww, binwidth =0.1)+
  scale_x_continuous(limits = c(min(ww$residual.sugar), max(ww$residual.sugar)),
                     breaks = seq(min(ww$residual.sugar), max(ww$residual.sugar), 10))

# Create new varaible by cutting into 2 buckets
ww$sugar.bucket <- cut(ww$residual.sugar, c(0.5, 2.5, 32)) 

# Transform x to log10
sugar.dist.log <- qplot(x = residual.sugar, data = ww, 
                        binwidth = 0.02, fill = sugar.bucket)+
  scale_x_log10()

grid.arrange(sugar.dist, sugar.dist.log,  ncol=2)
ProportionTable(ww$sugar.bucket)
```
The distribution of residual sugar content is skewed with a right long tail. Thus, the log10 transformation helps better understand the distribution of sugar content. It appears to be bimodal with sugar content peaking at around 1.5 or so and again at 8 g/L or so. I created a new variable called **sugar.bucket**, which separated sugar content into 2 classes: <=2.5 (35%) and >2.5 (65%). 

According to [data info notes](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt), it is rare to find wines with less than 1 g/L of sugar. And wines with greater than 45 g/L sugar are considered sweet.
#### What percentage of white wines are sugar content less than 1 g/L sugar or greater than 45 g/L sugar?
```{r echo=FALSE, warning=FALSE, message=FALSE, Univariate_Plots_residual.sugar}
# Craete a function to calculate percentages of wines with less than the value i 
proportion <- function(col, i) {
  prop <- sum(col < i) / length(col) * 100
  return(prop)
}

proportion(ww$residual.sugar, 1)
100-proportion(ww$residual.sugar, 45)
```
The white wine less than 1 g/L is 1.6% of the total. And sweet white wine is only 0.02% of the total, which is very small. I am not sure if "Vinho Verde" white wines are not sweet in general, or if the cutoff of sugar content is more for red wine in general. 
#### How the sugar contents are distriubted for red wines?
```{r echo=FALSE, Univariate_Plots_residual.sugar from red wines}
rw <- read.csv('wineQualityReds.csv')
summary(rw$residual.sugar)
```
Just quick overviewing the stats of residual sugar content from red wines, the Midian is 2.2 and the max is 15.5 g/L which are a lot lower than white wines. Thus, the cutoff (45 g/L) of sugar content for sweet wines is not for red wines either.

### NaCl(salt) content
#### How the nacl content variable is distriubted?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of chlorides variable
NaCl.dist <- qplot(x = chlorides, data = ww, binwidth =0.001)+
  scale_x_continuous(limits = c(min(ww$chlorides), max(ww$chlorides)),
                     breaks = seq(min(ww$chlorides), max(ww$chlorides), 0.1))

# Transform x to log10
NaCl.dist.log <- qplot(x = chlorides, data = ww, binwidth =0.01)+
  scale_x_log10()

grid.arrange(NaCl.dist, NaCl.dist.log, ncol=2)
summary(ww$chlorides)

# Calculate percentages of wines with less than 0.1 g/L
proportion(ww$chlorides, 0.1)
```
The distribution of NaCl content is skewed with a right long tail. Thus, the log10 transformation helps better understand the distribution of NaCl content, which looks close to normal. A majority (97.8%) of white wines are less than 0.1 g/L in NaCl content and those between 0.04 and 0.05 are common.

### Density
#### How the density variable is distriubted?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of density variable
density.dist <- qplot(x = density, data = ww, binwidth =0.0001)+
  scale_x_continuous(limits = c(min(ww$density), max(ww$density)),
                     breaks = seq(0.980,  max(ww$density), 0.01))

# Zoom in the x scale
density.dist.zoom <- qplot(x = density, data = ww, binwidth =0.0001)+
  scale_x_continuous(limits = c(min(ww$density), quantile(ww$density, 0.999)),
                     breaks = seq(0.980, quantile(ww$density, 0.999), 0.004))

grid.arrange(density.dist, density.dist.zoom, ncol=2)
summary(ww$density)

# Calculate percentages of wines with less than 1 Kg/L
100-proportion(ww$density, 1)
```
The lightest and heaviest wines are 0.9871 and 1.0390 Kg/L in density, respectively. Most white wines are between 0.9917 and 0.9961 Kg/L in density. Although the distribution is skewed to the right, log or square root transformations did not improve normality. Excluding top 0.1% helps to better understand the distribution. 
Density possibly contributes to taste of wine. Density depends on the alcohol and sugar contents. The wines heavier than or equal to water (1 Kg/L) are rare (1.9%). 
 
### Acidity including pH, fixed.acidity, volatile.acidity, and citric.acid
#### pH
```{r echo=FALSE, fig.height=3, fig.width=4, message=FALSE, warning=FALSE}
# Explore distribution of pH variable
qplot(x = pH, data = ww, binwidth =0.01)+
  scale_x_continuous(limits = c(min(ww$pH), max(ww$pH)),
                     breaks = seq(2.7, max(ww$pH), 0.1))

summary(ww$pH)
```

#### tartaric acid content (nonvolatile or fixed acidity)
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of fixed.acidity variable
tartaric.dist <- qplot(x = fixed.acidity, data = ww, binwidth =0.1)+
  scale_x_continuous(limits = c(min(ww$fixed.acidity), max(ww$fixed.acidity)),
                     breaks = seq(3, max(ww$fixed.acidity), 1))

# Transform x to log10
tartaric.dist.log <- qplot(x = fixed.acidity, data = ww, binwidth =0.005)+
  scale_x_log10()

grid.arrange(tartaric.dist, tartaric.dist.log, ncol=2)

summary(ww$fixed.acidity)
```


#### acetic acid content (volatile acidity)
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of volatile.acidity variable
acetic.dist <- qplot(x = volatile.acidity, data = ww, binwidth =0.01)+
  scale_x_continuous(limits = c(min(ww$volatile.acidity), max(ww$volatile.acidity)),
                     breaks = seq(0.1, max(ww$volatile.acidity), 0.2))

# Transform x to log10
acetic.dist.log <- qplot(x = volatile.acidity, data = ww, binwidth =0.02)+
  scale_x_log10()

grid.arrange(acetic.dist, acetic.dist.log, ncol=2)

summary(ww$volatile.acidity)

```

#### citric acid content
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of citric.acid variable
citric.dist <- qplot(x = citric.acid, data = ww, binwidth =0.01)+
  scale_x_continuous(limits = c(min(ww$citric.acid), max(ww$citric.acid)),
                     breaks = seq(min(ww$citric.acid), max(ww$citric.acid), 0.4))

# Transform x to square root
citric.dist.sqrt <- qplot(x = citric.acid, data = ww, binwidth =0.01)+
  scale_x_sqrt()

grid.arrange(citric.dist, citric.dist.sqrt, ncol=2)

print("Count and proportion of 0")
summary(ww$citric.acid == 0)  # count of the wines with 0 g/L citric acid
sum(ww$citric.acid == 0) / length(ww$acetic.bucket) * 100 # calculate percentage of the winew with 0 g/L

print("Count and proportion of 0.49")
summary(ww$citric.acid == 0.49)  # count of the wines with 0.49 g/L citric acid
sum(ww$citric.acid == 0.49) / length(ww$acetic.bucket) * 100 # calculate percetage of the winew with 0.49 g/L

# Zoom in the x scale
qplot(x = citric.acid, data = ww, binwidth =0.01)+
  scale_x_continuous(limits = c(0.45, 0.55),
                     breaks = seq(0.45, 0.55, 0.01))

```
(1) pH is already in log term so the distribution is normal. The lowest and the highest in pH of white wine are 2.72 and 3.82, respectively. The most common pH was between 3.1 and 3.3.

(2) tartaric acid: the lowest and highest in tartaric acid content are 3.8 and 14.2 g/L, respectively. Most white wines are between 6.3 and 7.3 g/L in tartaric acid. 

(3) acetic acid: the lowest and highest in acetic acid content are 0.08 and 1.1 g/L, respectively. Most white wines are between 0.21 and 0.32 g/L in acetic acid. 

(4) citric acid: the lowest and highest in citric acid content are 0 and 1.66 g/L, respectively. There are 19 zeros. Most white wines are between 0.27 and 0.39 g/L in citric acid. There is unusual high count at 0.49 g/L. 

Because the distributions of the three acid variables are skewed to the right, log transformation helps to get better distribution for tartaric and acetic acids, and the values of citric acid (having zeros) are square root transformed. 

According to the [data info notes](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt), excess amount of acetic acid can cause an unpleasant and vinegar taste, while citric acid can add freshness and flavor to wines. Thus, the 4 variables indicating acidity of wine are likely related to each other as well as to wine quality. 

### Antimicrobial and antioxidant contents, including sulphates, total.sulfur.dioxide, and free.sulfur.dioxide
#### K2SO4 content (potassium sulphate)
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distsribution of sulphates variable
K2SO4.dist <- qplot(x = sulphates, data = ww, binwidth =0.01)+
  scale_x_continuous(limits = c(min(ww$sulphates), max(ww$sulphates)),
                     breaks = seq(0.2, max(ww$sulphates), 0.1))

# Transform x to log10
K2SO4.dist.log <- qplot(x = sulphates, data = ww, binwidth =0.01)+
  scale_x_log10()

grid.arrange(K2SO4.dist, K2SO4.dist.log, ncol=2)

summary(ww$sulphates)
```

#### Total SO2 content
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of total.sulfur.dioxide variable
t.SO2.dist <- qplot(x = total.sulfur.dioxide, data = ww, binwidth = 1)+
  scale_x_continuous(limits = c(min(ww$total.sulfur.dioxide), max(ww$total.sulfur.dioxide)),
                     breaks = seq(min(ww$total.sulfur.dioxide), max(ww$total.sulfur.dioxide), 50))

# Transform x to square root
t.SO2.dist.sqrt <- qplot(x = total.sulfur.dioxide, data = ww, binwidth =0.1)+
  scale_x_sqrt()

grid.arrange(t.SO2.dist, t.SO2.dist.sqrt, ncol=2)

summary(ww$total.sulfur.dioxide)
```

#### Free SO2 content
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Explore distribution of free.sulfur.dioxide variable
f.SO2.dist <- qplot(x = free.sulfur.dioxide, data = ww, binwidth =1)+
  scale_x_continuous(limits = c(min(ww$free.sulfur.dioxide), max(ww$free.sulfur.dioxide)),
                     breaks = seq(0, max(ww$free.sulfur.dioxide), 50))

# Transform x to log10
f.SO2.dist.log <- qplot(x = free.sulfur.dioxide, data = ww, binwidth =0.02)+
  scale_x_log10()

grid.arrange(f.SO2.dist, f.SO2.dist.log, ncol=2)

summary(ww$free.sulfur.dioxide)

summary(ww$free.sulfur.dioxide > 50)  # count of the wines with higher than 50 mg/L

sum(ww$free.sulfur.dioxide > 50) / length(ww$free.sulfur.dioxide) * 100  # percentages of wines with less than 50 mg/L
```
(1) sulphates: the lowest and highest in sulphates content are 0.22 and 1.08 g/L, respectively. Most white wines are between 0.41 and 0.55 g/L in sulphates. 

(2) total SO2: the lowest and highest in total SO2 content are 9 and 440 mg/L, respectively. Most white wines are between 108 and 167 mg/L in total SO2. 

(3) free SO2: the lowest and highest in free SO2content are 2 and 289 mg/L, respectively. Most white wines are between 23 and 46 mg/L in free SO2. 

Because the distributions of all three variables are skewed to the right, log transformation helps to get better distribution for sulphates and free SO2. And the values of total SO2 are square root transformed. 

According to the [data info notes](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt), free SO2 prevents microbial growth and the oxidation of wine, but over 50 mg/L of free SO2 (about 18%), SO2 becomes evident in the nose and taste of wine. Thus, free SO2 is likely related to wine quality. In addition, sulfates are an additive that contributes to SO2 gas, and so all three variables indicating sulfur content are likely related to each other.


## 2.1.2 Univariate Analysis

### What is the structure of your dataset?
There were 4,898 white wines in the dataset with 1 sensory data (quality score) and 11 physicochemical properties (alcohol, sugar, NaCl, tartaric acid, acetic acid, citric acid, K2SO4, total and free SO2 contents, pH, and density). All physicochemical properties were numeric variables, and the quality variable was integer.

Other observations:
- The most common white wines were quality score of 6.
- Alcohol content ranged from 8 to 14.2% and the median alcohol was 10.4%.
- Sugar content ranged from 0.6 to 65.8 g/L and most white wines were around 2 and 10 g/L.
- Salt content was less than 0.1 g/L for most white wines (98%) with the median of 0.043 g/L.
- Density ranged from 0.9871 to 1.0390 Kg/L with the median of 0.9937 Kg/L.
- Acidity ranged from pH 2.72 to pH 3.82 with the median of pH 3.18.
- The medians of tartaric, acetic, and citric acid contents were 6.8, 0.26, and 0.32 g/L, respectively.
- The medians of K2SO4, total and free SO2 contents were 0.47 g/L, 134 mg/L, and 34 mg/L, respectively.


### What is/are the main feature(s) of interest in your dataset?
The main feature in the data set was quality score. I would like to determine which physicochemical properties (input variables) are best for predicting the quality of white wine (output variable). The measurements of physicochemical properties could be responsible for smell and taste of white wine. For examples, sugar for sweetness, NaCl for saltiness, acidity for sourness, acetic acid for vinegary taste, citric acid for citrus flavor, and free SO2 for pungent odor. I think that the balance among these flavors can contribute to the wine quality, thus some combination of physicochemical properties can be used to complement sensory tests or build a predictive model to sensory tests.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
The article (Cortez 2009) hinted that there is relationship between alcohol and residual sugar contents since alcohol production depends on grape sugar level and fermentation process. After reading some basics about wine tasting, too much or too little of alcohol, sweets, acids are not preferred and balancing among the ingredients is required for good quality. Focusing on high quality wines to compare how physicochemical properties of high quality wines are distributed differently from the others might help to understand any consistent trends for high quality. 

### Did you create any new variables from existing variables in the dataset?
I created 6 new variables including quality.order, quality.con, quality.lib, alcohol.bucket, alcohol.body, sugar.bucket. 

- quality.order is a variable changed from existing variable quality, which was numeric, to ordered factor with 7 levels.
- quality.con is a variable also changed from variable quality, by cutting into evenly distributed 3 levels. 
- quality.lib is a variable also changed from variable quality, by cutting into unproportionally distributed 3 levels.
- alcohol.bucket is a variable changed from existing variable alcohol, by evenly cutting numbers into 4 levels. 
- alcohol.body is a variable also changed from alcohol to 3-leveled categoroy, by following conventional body levels of wines.
- sugar.bucket is a variable changed from existing variable residual.sugar and separated into 2 levels guided by bimodal distribution. 

Reasoning: ordered or categorical factors are useful to color data as well as draw statistics on plots for further analysis.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
I log- or square root-transformed the right skewed distributions. The distributions of NaCl, sugar, tartaric and acetic acids, K2SO4, free SO2 were strongly skewed to the right, so log-transformation was used to reduce the strong right skewness. The transformed distribution for sugar appeared bimodal with the sugar peaking at around 1.5 or so and again at 8 g/L or so. Some wines had zero values of citric acid, so square root transformation was applied to reduce the right skewness for citric acid. The distribution of total SO2 was weakly skewed, so squared root transformation was used.



## 2.2.1 Bivariate Plots Section

### Numeric variables analysis: regressions
### Multivariate Outliers
I will use multivariate approach to detect outliers instead of looking at all pairs of variables. This way I can detect universal outliers shown across all the variables. But there might be more detectable outliners by pair-wise approach.

#### Is there any outlier?
```{r echo=FALSE, fig.height=3, fig.width=4, message=FALSE, warning=FALSE}
# Create new dataframes including only numeric variables
ww_subset <- ww[c(2:13)]

# Create Chi-Square Plot to identify outliers using mvoutlier package
chisq.plot(ww_subset)
```
```{r echo=FALSE, message=FALSE, remove_outlier}
# Identify the outlier from chi square plot using the interacting plot 
ww[2782, ]

# Remove observation of 2782
ww <- ww[-c(2782), ]
ww_subset <- ww_subset[-c(2782), ]

dim(ww)
dim(ww_subset)
```
The outlier detected is X = 2782 with Sq. Mahalanobis Distance of 3800. Observation 2782 has extreme values in acetic acid, sugar, and density, and the values of the other variables are far from the medians. I decided to delete this row.

I have noticed that the columns' names are too long for such scatterplot matrix so I will rename all the columns for simplicity and readibility on the plots.
```{r message=FALSE, warning=FALSE, rename_col}
# Rename variables 
ww_subset <- rename(ww_subset, 
       c("alcohol" = "alco",
         "residual.sugar" = "sugar",
         "chlorides" = "NaCl",
         "density" = "dens",
         "fixed.acidity" = "tart", 
         "volatile.acidity" = "acet", 
         "citric.acid" = "citr",          
         "sulphates" = "K2SO4",
         "free.sulfur.dioxide" = "fSO2",
         "total.sulfur.dioxide" = "tSO2",
         "quality" = "qual"))
```

I will generate a new datafram that includes log- or squareroot-transformed data according to the univariate analysis results.
```{r message=FALSE, warning=FALSE, transformed_dataframe}
# Create another dataframe including transformed data
tart.log <- log10(ww_subset$tart)
acet.log <- log10(ww_subset$acet)
citr.sqrt <- sqrt(ww_subset$citr)
suga.log <- log10(ww_subset$sugar)
NaCl.log <- log10(ww_subset$NaCl)
fSO2.log <- log10(ww_subset$fSO2)
tSO2.sqrt <- sqrt(ww_subset$tSO2)
dens <- ww_subset$dens
pH <- ww_subset$pH
SO4.log <- log10(ww_subset$K2SO4)
alco <- ww_subset$alco
qual <- ww_subset$qual

ww_trans <- data.frame(alco, suga.log, NaCl.log, dens,
                       pH, tart.log, acet.log, citr.sqrt,
                       SO4.log, tSO2.sqrt, fSO2.log, qual)
```

#### What does chi-square plot look like after transformation? Is there any outlier?
```{r echo=FALSE, fig.height=3, fig.width=4, message=FALSE, warning=FALSE}
chisq.plot(ww_subset) 
chisq.plot(ww_trans)
chisq.plot(ww_trans[ , -4]) # without sugar variable
```
I notice a great difference in range of x-axis. By transforming variables, it helps reduce overall outliers, plus plotting it without sugar variable improves a lot.


### Scatterplot Matrix
#### What pairs of variables have strong correlations?
```{r echo=FALSE, fig.height=8, fig.width=8, message=FALSE, warning=FALSE}
ggpairs(ww_trans, 
        lower = list(continuous = wrap(ggally_points, size = 0.2)),
        upper = list(continuous = wrap("cor", size = 4, color = 'black'))) + 
  theme_void()
```
- The main feature of interest is quality. Alcohol, density, NaCl, acetic acid, and total SO2 seem to have medium to weak correlation with quality score. 
- Other than main features, density is an interesting variable, which has strong correlations with alcohol, sugar, and total SO2 and weak correlations with NaCl, free SO2, and tartaric acid. 
- Alcohol is correlated with NaCl, total SO2, sugar, and free SO2. 
- pH is correlated with tartaric and citric acid and K2SO4, but not with acetic acid. 
- Citric acid was weakly correlated with tartaric and acetic acids. 
- Free and total SO2 was strongly correlated. 
- Sugar was correlated with free and total SO2. 
- NaCl and total SO2 weakly were correlated.

### Correlation Network Matrix
```{r echo=FALSE, fig.height=7, fig.width=6, message=FALSE, warning=FALSE, r echo=FALSE}
qgraph(cor(ww_trans))
qgraph(cor(ww_trans), minimum=0.2, edge.labels=TRUE, edge.label.cex=1.5)
```



#### What are the r-square values between quality vs. alcohol and quality vs. density?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Build the Linear Model
qual.model1 <- lm(I(quality) ~ I(alcohol), data = ww)
qual.mode2 <- lm(I(quality) ~ I(density), data = ww)
mtable(qual.model1, qual.mode2, sdigits = 3)
```
Alcohol can explain 19% of the variance in quality score and density can 10%.

### Categorical variable analysis: boxplot or density plot
```{r echo=FALSE, warning=FALSE, Bivariate_Plots}
# Create categorical variables of quality in ww_trans dataframe
#ww_trans$quality.con <- ww$quality.con
#ww_trans$quality.lib <- ww$quality.lib
```
### Boxplots grouped by quality.con
I will create boxplots of all physicochemical properties grouped by quality.cons (<6, 6, >6) to find general trends. 
#### Is there any noticeable trend from low and middle to high quality, which was not detected from correllation analysis?
```{r echo=FALSE, fig.height=4, fig.width=3, message=FALSE, warning=FALSE}
# Create a function to generate a boxplot with x-axis as quality.con and y-axis as input column
Plot2 <- function(col, quality, lab) {
  qplot(x= quality, y= col, geom = 'boxplot', ylab = lab)+ 
  geom_jitter(alpha = 1/10, color = 'royalblue')
}

# Iterate every column to generate boxplot from ww_trans dateframe
for (i in 1:11) {
  print(Plot2(ww_trans[ , i], ww$quality.con, colnames(ww_trans)[i]))
}
```
Alcohol, NaCl, density, and pH seem to have consistent trends from low to high quality wines. For the other properties, in contrast, the high quality wines share a similar distribution of the other level of quality. 

It is surprising to see some consistent trends of decreasing sugar with increasing quality from the boxplot although there is no correlation between sugar and quality (r = -0.065). This makes me wonder if linear relationship was hidden due to bimodality.

Although boxplots show the general trends, I am not sure whether the differences are statistically significant or not. Thus, I will perform one-way ANOVA test on each variable by quality.con.
#### Are the differences statistically significant?
```{r echo=FALSE, warning=FALSE, Bivariate_Plots_ANOVA}
# Create a function to generate ANOVA table
aov_table <- function (col) {
  col.aov <- aov(col ~ ww$quality.con)
  summary(col.aov)
}

# Iterate every column to generate an ANOVA table from ww_trans dateframe
for (i in 1:11) {
  a <- colnames(ww_trans)[i] 
  b <- aov_table(ww_trans[ , i])
  print(list(a, b))
}
```
Apperantly, the ANOVA test is not very helpful in this case because all variables significantly vary by quality.con.  

### Density plots grouped by quality.lib
I will create density plots of all physicochemical properties grouped by quality.lib (<5, 5-7, >7) to find the trends of low-end and high-end cases. The advantage of density plot is the area under the curve is normalized for imbalanced class sizes.

#### Is there any noticeable trend from low to high quality?
```{r echo=FALSE, fig.height=3, fig.width=5, message=FALSE, warning=FALSE}
# Create a function to generate a boxplot with x-axis as quality.con and y-axis as input column
Plot3 <- function(col, quality, lab) {
  qplot(x= col, color = quality, geom = 'density', xlab = lab)+
    scale_color_brewer(palette = "RdBu")+
    theme_dark()
}

# Iterate every columns to generate boxplots from ww_trans dateframe
for (i in 1:11) {
  print(Plot3(ww_trans[ , i], ww$quality.lib, colnames(ww_trans)[i]))
}
```
The density plots of alcohol, NaCl, density, and pH are reconfirming that for these properties the distributions of very high quality differs from that of very low quality. In addition, SO4 of high quality wine has slightly different distribution from medium and low quality wine. And acetic acid, total SO2 and free SO2 seem to have distinct trends of low quality wine compared to mediumn and high quality wine, which were not detected from boxplots.

### Density plots and regression grouped by sugar.bucket
Due to bimodality of residual.sugar distribution, I will take look at the distributions separately by two groups (<2.5, >2.5).

#### What are the distributions of residual.sugar in the two separate groups? And what are the distribution of quality in the two groups?
```{r echo=FALSE, fig.height=3, fig.width=7, message=FALSE, warning=FALSE}
# Create density plots separated by sugar.bucket
sugar.freq.log <- qplot(x= residual.sugar, data = ww, color = sugar.bucket, geom = 'density')+
  scale_x_log10()+
  scale_color_brewer(palette = "RdBu")+
  theme_dark()

suga.qual.freq <- qplot(x = quality, data = ww, binwidth = 1, geom = 'density', color = sugar.bucket)
  scale_color_brewer()+
  theme_dark()

grid.arrange(sugar.freq.log, suga.qual.freq, ncol=2)

print("residual.sugar")
by(ww$residual.sugar, ww$sugar.bucket, summary)

print("quality")
by(ww$quality, ww$sugar.bucket, summary)
```
The distribution of each sub-group by sugar is close to normal with its own central. Low sugar group (<2.5) has a median of 1.5 while high sugar group (>2.5) had a median of 8.2. Despite the bimodality of residual.sugar distribution, the quality in both groups is distributed very similarily, with the quality median of 6. 

#### Do correlations between sugar and quality differ in the two groups?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Create a function to draw scatterplots with linear fit line
Plot4 <- function(dataset, x, y, z, opts = NULL) {
  ggplot(dataset, aes_string(x = x, y = y, color = z)) +
   geom_point(alpha = 1/10, position = position_jitter(h = 0), size = 2) +
   geom_smooth(method = 'lm')+
   scale_color_brewer(palette = "Set1")
}

qual.suga1 <- Plot4(ww, "quality", "residual.sugar", NULL)+ 
  scale_y_log10()
qual.suga2 <- Plot4(ww, "quality", "residual.sugar", "sugar.bucket") + 
  scale_y_log10()

grid.arrange(qual.suga1, qual.suga2, ncol=2)

# Correlation on each group
print("(0.5,2.5]")
with(subset(ww, sugar.bucket == "(0.5,2.5]"), cor.test(residual.sugar, quality))
print("(2.5,32]")
with(subset(ww, sugar.bucket == "(2.5,32]"), cor.test(residual.sugar, quality))
```
The correlation with quality is improved a little bit by separating into two groups. Low sugar group (0.5,2.5] is positively correlated with quality (r=0.172), while high sugar group (2.5,32] is negatively correlated with quality (r=-0.156).

### Relationship between freeSO2 vs. quality
Density plot of freeSO2 showed an interesting trends although linear regression and boxplot did not show any promissing trends. Low quality wines are relatively more distributed to high-end as well as low-end freeSO2 while medium and high quality wines remain at the middle level of freeSO2. I wonder if too high or too low amounts of freeSO2 are related to low quality of wine.

#### What are the distributions of quality in the sub-groups by freeSO2?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Create a new varaible by cutting into 4 buckets
ww$freeSO2.bucket <- cut(ww$free.sulfur.dioxide,
                             c(1, 5, 50, 120, 290))

# Create a function to generate a output set of proportion table, density plots, and summary table
Plot5 <- function(col, bucket) {
  a <- ProportionTable(bucket)
  
  b <- qplot(x = quality, data = ww, geom = 'density', color = bucket)+
  scale_color_brewer(palette = "RdBu")+
  theme_dark()
  
  c <- Plot3(col, ww$quality.order, NULL)
  
  d <- "quality"
  e <- by(ww$quality, bucket, summary)
  
  return(list(a, b, c, d, e))
}

Plot5(ww$free.sulfur.dioxide, ww$freeSO2.bucket)
```
According to [data info notes](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityInfo.txt), free SO2 over 50 mg/L becomes evident in the nose and taste of wine, but the measurement of free SO2 alone is not necessary to determine wine quality. 

Majority of wines (82%) have free SO2 below 50 mg/L. The density plot shows that the quality of wine with below and above 50 mg/L of free SO2 are distributed similarly. However, the quality of extreme case (1% of the wine samples) where free SO2 are lower than 5 mg/L (1% of the sample size) or higher than 120 mg/L (0.1% of the sample size) is shown to be low. So, if white wine has too little or too much free SO2, the quality unlikely would be higher than 6. This suggest that free SO2 is required at a certain level (20-50 mg/L) to compromise between preservation purpose (antioxidant) and good smell, but there is no linear relationship between free SO2 and quality.

### Relationship between totalSO2 vs. quality
Total SO2 has a similar trend but a lesser extent like freeSO2 has.
#### What are the distributions of quality in the sub-groups by totalSO2?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Create a new varaible by cutting into 4 buckets
ww$totalSO2.bucket <- cut(ww$total.sulfur.dioxide,
                             c(8, 30, 50, 250, 440))

Plot5(ww$total.sulfur.dioxide, ww$totalSO2.bucket)
```
Similarily, the quality of extreme case (0.9% of the wine samples) where total SO2 are lower than 30 mg/L or higher than 250 mg/L is shown to be low. So, if white wine has too little or too much total SO2, the quality unlikely would be higher than 6. 


### Rerationship between acetic acid vs. quality
The distribution of acetic acid by quality also suggests the possibility of that high-end values are an indicator of low quality wine.  
#### What are the distributions of quality in the sub-groups by acetic acid?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Create new varaible by cutting into 3 buckets
ww$acetic.bucket <- cut(ww$volatile.acidity,
                             c(0, 0.8, 1.1))

Plot5(ww$volatile.acidity, ww$acetic.bucket)
```
It is very rare (0.1% of the sample size) that the wine would have acetic acid exceeding 0.8 g/L but if white wine has too much acetic acid, the quality unlikely would be higher than 5. 

### Rerationship between citric acid vs. quality
Although the median of citric acid is 0.32, there is unusual high count (4% of sample size) at 0.49 g/L and there is zero value for about 0.4% of sample. 
#### What are the distributions of quality when citric acid is at 0.49 or 0?
```{r echo=FALSE, fig.height=3, fig.width=6, message=FALSE, warning=FALSE}
# Create a new variable by converting numerical to logical data type
ww$citr0.49 <- ww$citric.acid == 0.49 # True being citric.acid == 0.49 and False being != 0.49
ww$citr0 <- ww$citric.acid == 0.0 # True being citric.acid == 0 and False being != 0

# Create density plot and summary table
qplot(x = quality, data = ww, geom = 'density', color = citr0.49)
print("citr0.49")
by(ww$quality, ww$citric.acid == 0.49, summary)

print("citr0")
qplot(x = quality, data = ww, geom = 'density', color = citr0)
by(ww$quality, ww$citric.acid == 0.0, summary)
```
The quality distribution of the group with citric acid of 0.49 seems similar to the distribution by remaining samples, while the wines with zero citric acid are relatively lower in quality and they unlikely would have quality higher than 6.  


## 2.2.2 Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?
The scatterplot matrix, boxplots and density plots grouped by quality.con and qality.lib, consistently showed relationship of quality with alcohol, density and NaCl, and to a lesser extent with pH, acetic acid, and total SO2. The highest correlation r values with quality were alcohol and density, but were not that strong: 0.436 and -0.307, respectively. And none of single variable alone can explain the variance in quality score more than 19%. I wonder if the combination of two or more variables can make better prediction model for quality. 

It was surprising to see some consistent trends of decreasing sugar with increasing quality from the boxplot although there was no correlation between sugar and quality (r = -0.065). Due to bimodality, some relationship could be hidden. Actually, the data of each modal behaved differently with quality. In low sugar group (<2.5 g/L), sugar was positively correlated with quality (r=0.172), while in high sugar group (>2.5 g/L), sugar was negatively correlated with quality (r=-0.156). 

freeSO2, totalSO2, and acetic acid showed that the extremely high or/and low values or even zero values of these variables were associated with low quality wine, though the extreme cases were very rare like about 0.1 to 1 %. 

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?
Strong correlations were detected among density, alcohol, total SO2, sugar, and NaCl. This indicated that these variables might be dependent on each other for some degree. The density of wine depends on content of alcohol, sugar, salts etc. Because alcohol is lighter than water (1kg/L), the more alcohol, the lower density can be achieved. And since solute such as sugar, NaCl, and SO2 contributes to adding density of solution, the more solute, the higher density can be achieved. As mentioned at the univariate analysis, during the fermentation process, sugar is taken up by yeast to produce alcohol. In general, the more alcohol content in wine, the less sugar remains. All of these correlations were observed either strongly or weakly.
 
### What was the strongest relationship you found?
The correlations between density and alcohol and between density and sugar were the strongest in white wine dataset with r value of -0.78 and 0.756, respectively. This information can be helpful for guiding wine choice based on taste preference such as sweat or dry and heavy- or light-bodied, yet weakly predicting wine based on quality. 

Among physicochemical properties, a single variable that had the strongest correlation with quality was alcohol. Wine with higher content of alcohol tended to be high in quality. Nonetheless, alcohol was explaining only 19% of the variance in quality, thus alcohol cannot be an only parameter for quality prediction model.


## 2.3.1 Multivariate Plots Section

### PCA (Principal component analysis)
One way to deal with multivariate dataset is to reduce dementionality by using PCA. For the first attempt, I will use all physicochemical properties from ww_trans dataframe. PCA might be very sensitive to different units and differences in variability among the variables. So, I will run PCA with scale which standardizing the variables to have 0 mean and 1 std.


#### What are the stdev and variance of each component, and variance?
```{r echo=FALSE, fig.height=4, fig.width=5, message=FALSE, warning=FALSE}
# Create a PCA data matrix
ww_trans.pca <- prcomp(ww_trans[,-12], scale=TRUE)
summary(ww_trans.pca)

# Create a scree plot
screeplot(ww_trans.pca, type = "lines")
```
[The Kaiser criterion](http://www.uta.edu/faculty/sawasthi/Statistics/stfacan.html) suggested that we can retain only factors with eigenvalues greater than 1. That means I can keep PC1 through PC4. But the obvious change in slope occurs between 2 and 3, which is the elbow of the scree plot. I can focus on PC1 and PC2.

#### What are the correlations of variables with PC1 and PC2?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Call the matrix of variable loadings
ww_trans.pca$rotation[ , 1:2] # PC1 and PC2 columns
```

#### Visualize variable loadings
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Call the matrix of variable loadings
qgraph.pca(ww_trans[,-12], factors=2)
```
The PC1 is positively correlated with alcohol but negatively correlated with density, totalSO2, sugar, NaCl, and freeSO2. The PC2 is positively correlated with tartaric acid and citric acid but negatively correlated with pH.

#### Visualize PCA
```{r, echo=FALSE, fig.height=6, fig.width=7}
# Create a biplot of individuals as points and variables as arrows
fviz_pca_biplot(ww_trans.pca, repel=TRUE, # repel to avoid overplotting text labels
                label="var", col.var="blue", # show labels in blue and only for variables
                habillage=ww$quality.con, palette="RdBu", # color points by grouping
                title="PCA biplot grouped by quality")+ # change title
    theme_dark()
```
As I expect, there is no distinct grouping by quality.con. The classes of quality are highly overlapping. However, there is a general trend of low to high quality from left top to right bottom, where most low quality wines are on the left side (Dim1<0) while most high quality wines are on the right side (Dim1>0). Thus, the quality seems positively related to Dim1 or PC1 which is highly influence by alcohol, density, sugar, NaCl, and total SO2.

#### What is the correlation between PC1 and quality?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Correlation test 
cor.test(ww_trans.pca$x[ , 1], ww$quality) # using x object to access the coordinates of the individuals (PC1 scores)
```
The correlation r value between PC1 and quality is 0.282, which is not better than correlation between quality and alcohol alone (0.436). So, using all variables into PCA does not improve in explaining quality.

#### How about 3D-plot using PC1, PC2, and PC3?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Draw a 3D plot
plot3d(ww_trans.pca$x[ , 1:3], col=as.integer(ww$quality.con)) # grouped by quality.con
#rgl.postscript("3d_pca.pdf","pdf")
```
![Alt text](/3d_pca.JPG)
The 3D-plot of PCA does not show any better separation of the classes.

#### What about selecting only variables that are often shown to be related each others? Would this improve in explaining quality?
```{r echo=FALSE, message=FALSE, warning=FALSE}
qgraph.pca(ww_trans[, c(1,2,3,4,10)], factors=2, rotation="varimax")
```
```{r echo=FALSE, fig.height=3, fig.width=4, message=FALSE, warning=FALSE}
# Create a subset of dataframe
ww_trans.subset<- ww_trans[, c(1,2,3,4,10)]

# Create a PCA data matrix
ww_trans.sub.pca <- prcomp(ww_trans.subset, scale=TRUE)
summary(ww_trans.sub.pca)

# Create a scree plot
screeplot(ww_trans.sub.pca, type = "lines")
```
```{r echo=FALSE, fig.height=6, fig.width=7, message=FALSE, warning=FALSE}
# Create a biplot of individuals as points and variables as arrows
fviz_pca_biplot((ww_trans.sub.pca), repel=TRUE, # repel to avoid overplotting text labels
                label="var", col.var="blue", # show labels in blue and only for variables
                habillage=ww$quality.con, palette="RdBu", # color points by grouping
                title="PCA biplot grouped by quality-selected variables")+ # change title
    theme_dark()
```
```{r echo=FALSE, fig.height=6, fig.width=7, message=FALSE, warning=FALSE}
# Create a biplot of individuals as points and variables as arrows
fviz_pca_biplot((ww_trans.sub.pca), repel=TRUE, # repel to avoid overplotting text labels
                label="var", col.var="blue", # show labels in blue and only for variables
                habillage=ww$alcohol.bucket, palette="RdBu", # color points by grouping
                title="PCA biplot grouped by Alcohol-selected variables")+ # change title
    theme_dark()
```

#### What is the correlation between PC1_selected and quality?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Correlation test 
cor.test(ww_trans.sub.pca$x[ , 1], ww$quality) # using x object to access the coordinates of the individuals (PC1 scores)
```
It helps little bit. The correlation r value is 0.330 but the individual points become spread out compared to all variables PCA.

#### How about 3D-plot using PC1, PC2, and PC3?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Draw a 3D plot
plot3d(ww_trans.sub.pca$x[ , 1:3], col=as.integer(ww$quality.con)) 
#rgl.postscript("3d_pca.pdf","pdf")
```
![Alt text](/3d_pca_subset.JPG)
Again, the separation by classes is not very good.




### Building the Linear Model
#### Can the combination of PCA scores explain quality?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Declare eigenvectors as short name for readibility
PC1 <- ww_trans.pca$x[ , 1]
PC2 <- ww_trans.pca$x[ , 2]
PC3 <- ww_trans.pca$x[ , 3]
PC4 <- ww_trans.pca$x[ , 4]
PC5 <- ww_trans.pca$x[ , 5]
PC6 <- ww_trans.pca$x[ , 6]
PC7 <- ww_trans.pca$x[ , 7]
PC8 <- ww_trans.pca$x[ , 8]
PC9 <- ww_trans.pca$x[ , 9]
PC10 <- ww_trans.pca$x[ , 10]
PC11 <- ww_trans.pca$x[ , 11]

# Building the Linear Model
m1 <- lm(ww$quality ~ PC1)
m2 <- update(m1, ~ . + PC2)
m3 <- update(m2, ~ . + PC3)
m4 <- update(m3, ~ . + PC4)
m5 <- update(m4, ~ . + PC5)
m6 <- update(m5, ~ . + PC6)
m7 <- update(m6, ~ . + PC7)
m8 <- update(m7, ~ . + PC8)
m9 <- update(m8, ~ . + PC9)
m10 <- update(m9, ~ . + PC10)
m11 <- update(m10, ~ . + PC11)

mtable(m1, m2, m3, m4, m5, m6,m7,m8,m9,m10,m11, sdigits = 3)
```
Unfortunately, the r-squared value of this linear model is 0.302, meaning this model can explain only 30% of variance in qaulity.

#### Can the combination of transformed variables explain quality?
```{r echo=FALSE, message=FALSE, warning=FALSE}
# Building the Linear Model

m1 <- lm(qual ~ alco, data=ww_trans)
m2 <- update(m1, ~ . + dens)
m3 <- update(m2, ~ . + NaCl.log)
m4 <- update(m3, ~ . + acet.log)
m5 <- update(m4, ~ . + tSO2.sqrt)
m6 <- update(m5, ~ . + tart.log)
m7 <- update(m6, ~ . + fSO2.log)
m8 <- update(m7, ~ . + acet.log)
m9 <- update(m8, ~ . + citr.sqrt)
m10 <- update(m9, ~ . + pH)
m11 <- update(m10, ~ . + suga.log)

mtable(m1, m2, m3, m4, m5, m6,m7,m8,m9,m10,m11, sdigits = 3)
```
The r-squared value of this linear model is 0.298, explaining 30% of variance in qaulity, which is similar to the previous model with PCA scores. As I expect, a linear model probably is not the best fit for this dataset.

## 2.3.2 Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?
Yes, to some degree, the combination of two or more variables improved prediction model for quality. From bivariate analysis, the highest r-squared value of linear model by a single variable was about 0.19. But by building model with combination of variables, the r-squared value increased up to 0.3.

### Were there any interesting or surprising interactions between features?
I mostly focused on performing PCA for multivariate analysis and I performed PCA on all variables and compared to PCA on 5 variables which were likely shown to be associated with quality. The PCA plot by the subset of variables did not really improve the separation of quality classes and there was a little improvement on the correlation between PC1 and quality. I may have chosen the variables are highly correlated each other (they seem dependent to each other) that does not really add any information to it.  

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.
As I mentioned previously, the linear model with combination of variables help increase a little bit of r-squared value, but not by much. It indicates that a linear model probably is not the best fit for this dataset. As the distribution of sugar contents (bimodality) and free&total SO2 and acetic acid (threshold effects) hinted, decision tree could be a good candidate, where a model predicts the value of a target variable by learning simple decision rules inferred from the data features. 


------

# 3. Final Plots and Summary

### 3.1 Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### 3.2 Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### 3.3 Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# 4. Reflection
# 5. Sources
- [relative frequency by a column]( http://www.r-tutor.com/elementary-statistics/qualitative-data/relative-frequency-distribution-qualitative-data)
- [returning multiple objects in function](https://stackoverflow.com/questions/8936099/returning-multiple-objects-in-an-r-function)
- [mvoutlier package: Multivariate Outlier Detection Based on Robust Methods](https://cran.r-project.org/web/packages/mvoutlier/mvoutlier.pdf)
- [renaming columns](http://www.cookbook-r.com/Manipulating_data/Renaming_columns_in_a_data_frame/)
- [three digits after decimal point printed in mtable](https://s3.amazonaws.com/content.udacity-data.com/courses/ud651/diamondsExample_2016-05.html)
- [Standardise variables](http://little-book-of-r-for-multivariate-analysis.readthedocs.io/en/latest/src/multivariateanalysis.html)
- [PCA plot using princomp() and qgraph](http://geog.uoregon.edu/GeogR/topics/pca.html)
- [visualize PCA, factoextra lib coupled with prcomp()](http://www.sthda.com/english/rpkgs/factoextra/reference/fviz_pca.html)
- [prcomp() vs. princomp()](http://www.sthda.com/english/wiki/principal-component-analysis-in-r-prcomp-vs-princomp-r-software-and-data-mining)
- [draw 3d pca](http://planspace.org/2013/02/03/pca-3d-visualization-and-clustering-in-r/)
- [rgl plot3d color points by group](http://r.789695.n4.nabble.com/plot3d-color-points-by-group-td3312955.html)
- [add an image to markdown](https://rpubs.com/RatherBit/90926)